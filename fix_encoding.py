#!/usr/bin/env python3
"""
修复工程文件中的乱码（UTF-8替换字符 �）
基于上下文推断原本的中文字符
"""

import re
from pathlib import Path

# 基于上下文的修复规则
# 格式: (匹配模式, 替换字符串)
CONTEXTUAL_FIXES = [
    # 用户请求
    (r'用户���求', '用户请求'),
    # 新的/新增
    (r'新���', '新增'),
    # 并行执行
    (r'并���执行', '并行执行'),
    # 注释
    (r'支持���释', '支持注释'),
    # 章节撰写
    (r'���节撰写', '章节撰写'),
    (r'章节��写', '章节撰写'),
    # 版本管理
    (r'��本管理', '版本管理'),
    # 负责
    (r'负���', '负责'),
    # 更新
    (r'最后���新', '最后更新'),
    # 引用
    (r'引���', '引用'),
    # 意图
    (r'���图', '意图'),
    (r'描述��图', '描述意图'),
    # 动态
    (r'���态', '动态'),
    # 读取
    (r'���取', '读取'),
    (r'缓存���取', '缓存读取'),
    # 精确
    (r'���确', '精确'),
    (r'过度依赖���确', '过度依赖精确'),
    # 忽视
    (r'���视', '忽视'),
    # 反馈
    (r'反��', '反馈'),
    (r'反��内容', '反馈内容'),
    # 项目
    (r'项���', '项目'),
    (r'项���特定', '项目特定'),
    # 生成的论文
    (r'生成��论文', '生成的论文'),
    # 具体
    (r'具体���', '具体的'),
    # 快照
    (r'���照', '快照'),
    (r'版本��照', '版本快照'),
    # 技术
    (r'���术', '技术'),
    (r'���术评审', '技术评审'),
    # 论文缓存管理 ——
    (r'论文缓存管理 ��', '论文缓存管理 ——'),
    # 撰写
    (r'��写', '撰写'),
    # 自组织
    (r'���组织', '自组织'),
    (r'��组织范式', '自组织范式'),
    # 语气
    (r'语���', '语气'),
    # 内容
    (r'内���', '内容'),
    (r'实际内���填充', '实际内容填充'),
    # 帮助
    (r'��助', '帮助'),
    (r'��助你在', '帮助你在'),
    # 论文
    (r'论���', '论文'),
    (r'两个论���生成', '两个论文生成'),
    # 中的
    (r'中���', '中的'),
    (r'中���期刊', '中的期刊'),
    # 证明
    (r'���明', '证明'),
    (r'试图���明', '试图证明'),
    # 注释/注
    (r'注��', '注释'),
    # 行
    (r'执��', '执行'),
    (r'并��执行', '并行执行'),
    # 责任
    (r'��任', '责任'),
    # 更新
    (r'��新', '更新'),
    # 快速
    (r'��速', '快速'),
    # 计算
    (r'��算', '计算'),
    # 忽略
    (r'��略', '忽略'),
    # 专业
    (r'专��', '专业'),
    # 角色
    (r'��色', '角色'),
    # 颜色
    (r'颜��', '颜色'),
    # 核心
    (r'��心', '核心'),
    # 支持
    (r'��持', '支持'),
    # 搜索
    (r'��索', '搜索'),
    # 输入
    (r'��入', '输入'),
    # 输出
    (r'��出', '输出'),
    # 结果
    (r'��果', '结果'),
    # 过程
    (r'��程', '过程'),
    # 阶段
    (r'��段', '阶段'),
    # 任务
    (r'��务', '任务'),
    # 信息
    (r'��息', '信息'),
    # 系统
    (r'��统', '系统'),
    # 功能
    (r'��能', '功能'),
    # 性能
    (r'��能', '性能'),
    # 资源
    (r'��源', '资源'),
    # 配置
    (r'��置', '配置'),
    # 设置
    (r'��置', '设置'),
    # 模块
    (r'��块', '模块'),
    # 组件
    (r'��件', '组件'),
    # 接口
    (r'��口', '接口'),
    # 数据
    (r'��据', '数据'),
    # 处理
    (r'��理', '处理'),
    # 分析
    (r'��析', '分析'),
    # 测试
    (r'��试', '测试'),
    # 验证
    (r'��证', '验证'),
    # 评估
    (r'��估', '评估'),
    # 优化
    (r'��化', '优化'),
    # 实现
    (r'��现', '实现'),
    # 设计
    (r'��计', '设计'),
    # 开发
    (r'��发', '开发'),
    # 部署
    (r'��署', '部署'),
    # 维护
    (r'��护', '维护'),
    # 管理
    (r'��理', '管理'),
    # 控制
    (r'��制', '控制'),
    # 监控
    (r'��控', '监控'),
    # 日志
    (r'��志', '日志'),
    # 报告
    (r'��告', '报告'),
    # 通知
    (r'��知', '通知'),
    # 警告
    (r'��告', '警告'),
    # 错误
    (r'��误', '错误'),
    # 异常
    (r'��常', '异常'),
    # 问题
    (r'��题', '问题'),
    # 解决方案
    (r'��决方案', '解决方案'),
    # 方法
    (r'��法', '方法'),
    # 策略
    (r'��略', '策略'),
    # 机制
    (r'��制', '机制'),
    # 流程
    (r'��程', '流程'),
    # 规范
    (r'��范', '规范'),
    # 标准
    (r'��准', '标准'),
    # 质量
    (r'��量', '质量'),
    # 安全
    (r'��全', '安全'),
    # 风险
    (r'��险', '风险'),
    # 成本
    (r'��本', '成本'),
    # 效率
    (r'��率', '效率'),
    # 效果
    (r'��果', '效果'),
    # 价值
    (r'��值', '价值'),
    # 优势
    (r'��势', '优势'),
    # 劣势
    (r'��势', '劣势'),
    # 机会
    (r'��会', '机会'),
    # 威胁
    (r'��胁', '威胁'),
    # 挑战
    (r'��战', '挑战'),
    # 机遇
    (r'��遇', '机遇'),
    # 创新
    (r'��新', '创新'),
    # 改进
    (r'��进', '改进'),
    # 提升
    (r'��升', '提升'),
    # 增强
    (r'��强', '增强'),
    # 减少
    (r'��少', '减少'),
    # 降低
    (r'��低', '降低'),
    # 避免
    (r'��免', '避免'),
    # 防止
    (r'��止', '防止'),
    # 保护
    (r'��护', '保护'),
    # 恢复
    (r'��复', '恢复'),
    # 备份
    (r'��份', '备份'),
    # 同步
    (r'��步', '同步'),
    # 异步
    (r'��步', '异步'),
    # 并发
    (r'��发', '并发'),
    # 并行
    (r'��行', '并行'),
    # 串行
    (r'��行', '串行'),
    # 顺序
    (r'��序', '顺序'),
    # 随机
    (r'��机', '随机'),
    # 循环
    (r'��环', '循环'),
    # 递归
    (r'��归', '递归'),
    # 迭代
    (r'��代', '迭代'),
    # 增量
    (r'��量', '增量'),
    # 全量
    (r'��量', '全量'),
    # 部分
    (r'��分', '部分'),
    # 整体
    (r'��体', '整体'),
    # 局部
    (r'��部', '局部'),
    # 全局
    (r'��局', '全局'),
    # 上下文
    (r'��下文', '上下文'),
    # 环境
    (r'��境', '环境'),
    # 条件
    (r'��件', '条件'),
    # 状态
    (r'��态', '状态'),
    # 事件
    (r'��件', '事件'),
    # 动作
    (r'��作', '动作'),
    # 行为
    (r'��为', '行为'),
    # 响应
    (r'��应', '响应'),
    # 请求
    (r'��求', '请求'),
    # 调用
    (r'��用', '调用'),
    # 触发
    (r'��发', '触发'),
    # 启动
    (r'��动', '启动'),
    # 停止
    (r'��止', '停止'),
    # 暂停
    (r'��停', '暂停'),
    # 恢复
    (r'��复', '恢复'),
    # 重启
    (r'��启', '重启'),
    # 关闭
    (r'��闭', '关闭'),
    # 开启
    (r'��启', '开启'),
    # 加载
    (r'��载', '加载'),
    # 保存
    (r'��存', '保存'),
    # 读取
    (r'��取', '读取'),
    # 写入
    (r'��入', '写入'),
    # 删除
    (r'��除', '删除'),
    # 修改
    (r'��改', '修改'),
    # 更新
    (r'��新', '更新'),
    # 创建
    (r'��建', '创建'),
    # 销毁
    (r'��毁', '销毁'),
    # 生成
    (r'��成', '生成'),
    # 销毁
    (r'��毁', '销毁'),
    # 构建
    (r'��建', '构建'),
    # 编译
    (r'��译', '编译'),
    # 解释
    (r'��释', '解释'),
    # 运行
    (r'��行', '运行'),
    # 调试
    (r'��试', '调试'),
    # 跟踪
    (r'��踪', '跟踪'),
    # 捕获
    (r'��获', '捕获'),
    # 抛出
    (r'��出', '抛出'),
    # 传播
    (r'��播', '传播'),
    # 忽略
    (r'��略', '忽略'),
    # 跳过
    (r'��过', '跳过'),
    # 继续
    (r'��续', '继续'),
    # 中断
    (r'��断', '中断'),
    # 终止
    (r'��止', '终止'),
    # 完成
    (r'��成', '完成'),
    # 结束
    (r'��束', '结束'),
    # 开始
    (r'��始', '开始'),
    # 准备
    (r'��备', '准备'),
    # 就绪
    (r'��绪', '就绪'),
    # 等待
    (r'��待', '等待'),
    # 超时
    (r'��时', '超时'),
    # 重试
    (r'��试', '重试'),
    # 失败
    (r'��败', '失败'),
    # 成功
    (r'��功', '成功'),
    # 完成
    (r'��成', '完成'),
    # 取消
    (r'��消', '取消'),
    # 撤销
    (r'��销', '撤销'),
    # 重做
    (r'��做', '重做'),
    # 回滚
    (r'��滚', '回滚'),
    # 提交
    (r'��交', '提交'),
    # 回退
    (r'��退', '回退'),
    # 前进
    (r'��进', '前进'),
    # 后退
    (r'��退', '后退'),
    # 返回
    (r'��回', '返回'),
    # 进入
    (r'��入', '进入'),
    # 退出
    (r'��出', '退出'),
    # 导入
    (r'��入', '导入'),
    # 导出
    (r'��出', '导出'),
    # 上传
    (r'��传', '上传'),
    # 下载
    (r'��载', '下载'),
    # 发送
    (r'��送', '发送'),
    # 接收
    (r'��收', '接收'),
    # 转发
    (r'��发', '转发'),
    # 广播
    (r'��播', '广播'),
    # 订阅
    (r'��阅', '订阅'),
    # 发布
    (r'��布', '发布'),
    # 推送
    (r'��送', '推送'),
    # 拉取
    (r'��取', '拉取'),
    # 获取
    (r'��取', '获取'),
    # 查询
    (r'��询', '查询'),
    # 检索
    (r'��索', '检索'),
    # 匹配
    (r'��配', '匹配'),
    # 比较
    (r'��较', '比较'),
    # 排序
    (r'��序', '排序'),
    # 过滤
    (r'��滤', '过滤'),
    # 分组
    (r'��组', '分组'),
    # 聚合
    (r'��合', '聚合'),
    # 统计
    (r'��计', '统计'),
    # 计算
    (r'��算', '计算'),
    # 累加
    (r'��加', '累加'),
    # 累减
    (r'��减', '累减'),
    # 乘法
    (r'��法', '乘法'),
    # 除法
    (r'��法', '除法'),
    # 加法
    (r'��法', '加法'),
    # 减法
    (r'��法', '减法'),
    # 取模
    (r'��模', '取模'),
    # 取整
    (r'��整', '取整'),
    # 舍入
    (r'��入', '舍入'),
    # 截断
    (r'��断', '截断'),
    # 拼接
    (r'��接', '拼接'),
    # 分割
    (r'��割', '分割'),
    # 合并
    (r'��并', '合并'),
    # 拆分
    (r'��分', '拆分'),
    # 压缩
    (r'��缩', '压缩'),
    # 解压
    (r'��压', '解压'),
    # 编码
    (r'��码', '编码'),
    # 解码
    (r'��码', '解码'),
    # 加密
    (r'��密', '加密'),
    # 解密
    (r'��密', '解密'),
    # 签名
    (r'��名', '签名'),
    # 验证
    (r'��证', '验证'),
    # 认证
    (r'��证', '认证'),
    # 授权
    (r'��权', '授权'),
    # 鉴权
    (r'��权', '鉴权'),
    # 权限
    (r'��限', '权限'),
    # 访问
    (r'��问', '访问'),
    # 拒绝
    (r'��绝', '拒绝'),
    # 允许
    (r'��许', '允许'),
    # 禁止
    (r'��止', '禁止'),
    # 限制
    (r'��制', '限制'),
    # 约束
    (r'��束', '约束'),
    # 检查
    (r'��查', '检查'),
    # 检测
    (r'��测', '检测'),
    # 校验
    (r'��验', '校验'),
    # 确认
    (r'��认', '确认'),
    # 确定
    (r'��定', '确定'),
    # 选定
    (r'��定', '选定'),
    # 指定
    (r'��定', '指定'),
    # 定义
    (r'��义', '定义'),
    # 声明
    (r'��明', '声明'),
    # 初始化
    (r'��始化', '初始化'),
    # 实例化
    (r'��例化', '实例化'),
    # 格式化
    (r'��式化', '格式化'),
    # 序列化
    (r'��列化', '序列化'),
    # 反序列化
    (r'��序列化', '反序列化'),
    # 规范化
    (r'��范化', '规范化'),
    # 标准化
    (r'��准化', '标准化'),
    # 自动化
    (r'��动化', '自动化'),
    # 可视化
    (r'��视化', '可视化'),
    # 个性化
    (r'��性化', '个性化'),
    # 定制化
    (r'��制化', '定制化'),
    # 本地化
    (r'��地化', '本地化'),
    # 全球化
    (r'��球化', '全球化'),
    # 国际化
    (r'��际化', '国际化'),
    # 专业化
    (r'��业化', '专业化'),
    # 智能化
    (r'��能化', '智能化'),
    # 数字化
    (r'��字化', '数字化'),
    # 信息化
    (r'��息化', '信息化'),
    # 网络化
    (r'��络化', '网络化'),
    # 平台化
    (r'��台化', '平台化'),
    # 生态化
    (r'��态化', '生态化'),
    # 体系化
    (r'��系化', '体系化'),
    # 结构化
    (r'��构化', '结构化'),
    # 模块化
    (r'��块化', '模块化'),
    # 组件化
    (r'��件化', '组件化'),
    # 服务化
    (r'��务化', '服务化'),
    # 微服务
    (r'��服务', '微服务'),
    # 分布式
    (r'��布式', '分布式'),
    # 集群
    (r'��群', '集群'),
    # 节点
    (r'��点', '节点'),
    # 主机
    (r'��机', '主机'),
    # 从机
    (r'��机', '从机'),
    # 客户端
    (r'��户端', '客户端'),
    # 服务端
    (r'��务端', '服务端'),
    # 前端
    (r'��端', '前端'),
    # 后端
    (r'��端', '后端'),
    # 终端
    (r'��端', '终端'),
    # 云端
    (r'��端', '云端'),
    # 本地
    (r'��地', '本地'),
    # 远程
    (r'��程', '远程'),
    # 在线
    (r'��线', '在线'),
    # 离线
    (r'��线', '离线'),
    # 连接
    (r'��接', '连接'),
    # 断开
    (r'��开', '断开'),
    # 绑定
    (r'��定', '绑定'),
    # 解绑
    (r'��绑', '解绑'),
    # 关联
    (r'��联', '关联'),
    # 解耦
    (r'��耦', '解耦'),
    # 耦合
    (r'��合', '耦合'),
    # 内聚
    (r'��聚', '内聚'),
    # 封装
    (r'��装', '封装'),
    # 继承
    (r'��承', '继承'),
    # 多态
    (r'��态', '多态'),
    # 抽象
    (r'��象', '抽象'),
    # 具体
    (r'��体', '具体'),
    # 虚拟
    (r'��拟', '虚拟'),
    # 物理
    (r'��理', '物理'),
    # 逻辑
    (r'��辑', '逻辑'),
    # 物理
    (r'��理', '物理'),
    # 逻辑
    (r'��辑', '逻辑'),
    # 简单
    (r'��单', '简单'),
    # 复杂
    (r'��杂', '复杂'),
    # 容易
    (r'��易', '容易'),
    # 困难
    (r'��难', '困难'),
    # 可能
    (r'��能', '可能'),
    # 确定
    (r'��定', '确定'),
    # 不确定
    (r'��确定', '不确定'),
    # 必然
    (r'��然', '必然'),
    # 偶然
    (r'��然', '偶然'),
    # 直接
    (r'��接', '直接'),
    # 间接
    (r'��接', '间接'),
    # 显式
    (r'��式', '显式'),
    # 隐式
    (r'��式', '隐式'),
    # 内部
    (r'��部', '内部'),
    # 外部
    (r'��部', '外部'),
    # 上层
    (r'��层', '上层'),
    # 下层
    (r'��层', '下层'),
    # 高层
    (r'��层', '高层'),
    # 低层
    (r'��层', '低层'),
    # 同级
    (r'��级', '同级'),
    # 同级
    (r'��级', '同级'),
    # 上级
    (r'��级', '上级'),
    # 下级
    (r'��级', '下级'),
    # 主要
    (r'��要', '主要'),
    # 次要
    (r'��要', '次要'),
    # 重要
    (r'��要', '重要'),
    # 必要
    (r'��要', '必要'),
    # 关键
    (r'��键', '关键'),
    # 核心
    (r'��心', '核心'),
    # 基础
    (r'��础', '基础'),
    # 基本
    (r'��本', '基本'),
    # 根本
    (r'��本', '根本'),
    # 本质
    (r'��质', '本质'),
    # 实质
    (r'��质', '实质'),
    # 实际
    (r'��际', '实际'),
    # 真实
    (r'��实', '真实'),
    # 虚假
    (r'��假', '虚假'),
    # 正确
    (r'��确', '正确'),
    # 错误
    (r'��误', '错误'),
    # 准确
    (r'��确', '准确'),
    # 精确
    (r'��确', '精确'),
    # 模糊
    (r'��糊', '模糊'),
    # 清晰
    (r'��晰', '清晰'),
    # 明确
    (r'��确', '明确'),
    # 详细
    (r'��细', '详细'),
    # 粗略
    (r'��略', '粗略'),
    # 完整
    (r'��整', '完整'),
    # 完整
    (r'��整', '完整'),
    # 部分
    (r'��分', '部分'),
    # 残缺
    (r'��缺', '残缺'),
    # 完美
    (r'��美', '完美'),
    # 优秀
    (r'��秀', '优秀'),
    # 良好
    (r'��好', '良好'),
    # 一般
    (r'��般', '一般'),
    # 普通
    (r'��通', '普通'),
    # 特殊
    (r'��殊', '特殊'),
    # 特别
    (r'��别', '特别'),
    # 特定
    (r'��定', '特定'),
    # 通用
    (r'��用', '通用'),
    # 专用
    (r'��用', '专用'),
    # 公用
    (r'��用', '公用'),
    # 私用
    (r'��用', '私用'),
    # 自用
    (r'��用', '自用'),
    # 他用
    (r'��用', '他用'),
    # 共享
    (r'��享', '共享'),
    # 独占
    (r'��占', '独占'),
    # 排他
    (r'��他', '排他'),
    # 兼容
    (r'��容', '兼容'),
    # 互斥
    (r'��斥', '互斥'),
    # 独立
    (r'��立', '独立'),
    # 依赖
    (r'��赖', '依赖'),
    # 关联
    (r'��联', '关联'),
    # 相关
    (r'��关', '相关'),
    # 无关
    (r'��关', '无关'),
    # 因果
    (r'��果', '因果'),
    # 果因
    (r'��因', '果因'),
    # 目的
    (r'��的', '目的'),
    # 手段
    (r'��段', '手段'),
    # 方式
    (r'��式', '方式'),
    # 形式
    (r'��式', '形式'),
    # 内容
    (r'��容', '内容'),
    # 本质
    (r'��质', '本质'),
    # 现象
    (r'��象', '现象'),
    # 表现
    (r'��现', '表现'),
    # 体现
    (r'��现', '体现'),
    # 反映
    (r'��映', '反映'),
    # 反应
    (r'��应', '反应'),
    # 反馈
    (r'��馈', '反馈'),
    # 前馈
    (r'��馈', '前馈'),
    # 输入
    (r'��入', '输入'),
    # 输出
    (r'��出', '输出'),
    # 入口
    (r'��口', '入口'),
    # 出口
    (r'��口', '出口'),
    # 来源
    (r'��源', '来源'),
    # 去向
    (r'��向', '去向'),
    # 起点
    (r'��点', '起点'),
    # 终点
    (r'��点', '终点'),
    # 源头
    (r'��头', '源头'),
    # 尽头
    (r'��头', '尽头'),
    # 上游
    (r'��游', '上游'),
    # 下游
    (r'��游', '下游'),
    # 前面
    (r'��面', '前面'),
    # 后面
    (r'��面', '后面'),
    # 之前
    (r'��前', '之前'),
    # 之后
    (r'��后', '之后'),
    # 以前
    (r'��前', '以前'),
    # 以后
    (r'��后', '以后'),
    # 先前
    (r'��先', '先前'),
    # 后来
    (r'��来', '后来'),
    # 首先
    (r'��先', '首先'),
    # 其次
    (r'��次', '其次'),
    # 再次
    (r'��次', '再次'),
    # 最后
    (r'��后', '最后'),
    # 最终
    (r'��终', '最终'),
    # 最初
    (r'��初', '最初'),
    # 最早
    (r'��早', '最早'),
    # 最晚
    (r'��晚', '最晚'),
    # 最快
    (r'��快', '最快'),
    # 最慢
    (r'��慢', '最慢'),
    # 最大
    (r'��大', '最大'),
    # 最小
    (r'��小', '最小'),
    # 最多
    (r'��多', '最多'),
    # 最少
    (r'��少', '最少'),
    # 最高
    (r'��高', '最高'),
    # 最低
    (r'��低', '最低'),
    # 最强
    (r'��强', '最强'),
    # 最弱
    (r'��弱', '最弱'),
    # 最好
    (r'��好', '最好'),
    # 最坏
    (r'��坏', '最坏'),
    # 最优
    (r'��优', '最优'),
    # 最差
    (r'��差', '最差'),
    # 最佳
    (r'��佳', '最佳'),
    # 最糟
    (r'��糟', '最糟'),
    # 理想
    (r'��想', '理想'),
    # 现实
    (r'��实', '现实'),
    # 理论
    (r'��论', '理论'),
    # 实践
    (r'��践', '实践'),
    # 实验
    (r'��验', '实验'),
    # 试验
    (r'��验', '试验'),
    # 检测
    (r'��测', '检测'),
    # 测试
    (r'��试', '测试'),
    # 检验
    (r'��验', '检验'),
    # 验证
    (r'��证', '验证'),
    # 确认
    (r'��认', '确认'),
    # 保证
    (r'��证', '保证'),
    # 确保
    (r'��保', '确保'),
    # 保障
    (r'��障', '保障'),
    # 保护
    (r'��护', '保护'),
    # 维护
    (r'��护', '维护'),
    # 维持
    (r'��持', '维持'),
    # 保持
    (r'��持', '保持'),
    # 保留
    (r'��留', '保留'),
    # 保存
    (r'��存', '保存'),
    # 保留
    (r'��留', '保留'),
    # 维持
    (r'��持', '维持'),
    # 维护
    (r'��护', '维护'),
    # 修复
    (r'��复', '修复'),
    # 恢复
    (r'��复', '恢复'),
    # 重建
    (r'��建', '重建'),
    # 重构
    (r'��构', '重构'),
    # 重写
    (r'��写', '重写'),
    # 重载
    (r'��载', '重载'),
    # 重置
    (r'��置', '重置'),
    # 重设
    (r'��设', '重设'),
    # 重新定义
    (r'��新定义', '重新定义'),
    # 重新实现
    (r'��新实现', '重新实现'),
    # 重新设计
    (r'��新设计', '重新设计'),
    # 重新开发
    (r'��新开发', '重新开发'),
    # 重新部署
    (r'��新部署', '重新部署'),
    # 重新配置
    (r'��新配置', '重新配置'),
    # 重新启动
    (r'��新启动', '重新启动'),
    # 重新加载
    (r'��新加载', '重新加载'),
    # 重新初始化
    (r'��新初始化', '重新初始化'),
    # 重新格式化
    (r'��新格式化', '重新格式化'),
    # 重新序列化
    (r'��新序列化', '重新序列化'),
    # 重新反序列化
    (r'��新反序列化', '重新反序列化'),
    # 重新规范化
    (r'��新规范化', '重新规范化'),
    # 重新标准化
    (r'��新标准化', '重新标准化'),
    # 重新自动化
    (r'��新自动化', '重新自动化'),
    # 重新可视化
    (r'��新可视化', '重新可视化'),
    # 重新个性化
    (r'��新个性化', '重新个性化'),
    # 重新定制化
    (r'��新定制化', '重新定制化'),
    # 重新本地化
    (r'��新本地化', '重新本地化'),
    # 重新全球化
    (r'��新全球化', '重新全球化'),
    # 重新国际化
    (r'��新国际化', '重新国际化'),
    # 重新专业化
    (r'��新专业化', '重新专业化'),
    # 重新智能化
    (r'��新智能化', '重新智能化'),
    # 重新数字化
    (r'��新数字化', '重新数字化'),
    # 重新信息化
    (r'��新信息化', '重新信息化'),
    # 重新网络化
    (r'��新网络化', '重新网络化'),
    # 重新平台化
    (r'��新平台化', '重新平台化'),
    # 重新生态化
    (r'��新生态化', '重新生态化'),
    # 重新体系化
    (r'��新体系化', '重新体系化'),
    # 重新结构化
    (r'��新结构化', '重新结构化'),
    # 重新模块化
    (r'��新模块化', '重新模块化'),
    # 重新组件化
    (r'��新组件化', '重新组件化'),
    # 重新服务化
    (r'��新服务化', '重新服务化'),
    # 特定修复 - 根据剩余乱码添加
    (r'你�� \*\*Version', '你是 **Version'),
    (r'指南�帮助', '指南帮助'),
    (r'��术评审专家', '技术评审专家'),
    (r'引用它��', '引用它们'),
    (r'不影响��完成', '不影响已完成'),
    (r'��视协调开销', '忽视协调开销'),
    (r'核心工���函数', '核心工具函数'),
    (r'Role hierarchy���allows property', 'Role hierarchy —— allows property'),
    (r'`���────', '`★ ────'),
    (r'├���─', '├──'),
]

def fix_corrupted_text(text):
    """根据上下文修复乱码文本"""
    result = text
    for pattern, replacement in CONTEXTUAL_FIXES:
        result = re.sub(pattern, replacement, result)
    return result

def fix_file(file_path):
    """修复单个文件"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        fixed_content = fix_corrupted_text(content)

        if fixed_content != content:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(fixed_content)
            return True
        return False
    except Exception as e:
        print(f"Error processing {file_path}: {e}")
        return False

def main():
    root_dir = Path('/Users/yyzz/Desktop/MyClaudeCode/paper-factory')

    # 需要扫描的目录
    dirs_to_scan = [
        root_dir,
        root_dir / 'docs',
        root_dir / '.claude' / 'skills',
        root_dir / 'agents',
        root_dir / 'workspace',
    ]

    fixed_count = 0
    checked_count = 0

    for base_dir in dirs_to_scan:
        if not base_dir.exists():
            continue
        for ext in ('*.md', '*.txt'):
            for file_path in base_dir.rglob(ext):
                # 跳过 .git 目录
                if '.git' in str(file_path):
                    continue
                checked_count += 1
                if fix_file(file_path):
                    print(f"Fixed: {file_path.relative_to(root_dir)}")
                    fixed_count += 1

    print(f"\n{'='*50}")
    print(f"Checked: {checked_count} files")
    print(f"Fixed: {fixed_count} files")

    # 检查是否还有剩余的乱码
    print(f"\n{'='*50}")
    print("Checking for remaining corruptions...")
    import subprocess
    result = subprocess.run(
        ['grep', '-r', '�', '--include=*.md', '--include=*.txt', '-l'],
        capture_output=True,
        text=True,
        cwd=root_dir
    )
    if result.stdout:
        remaining = result.stdout.strip().split('\n')
        print(f"Remaining files with corruption: {len(remaining)}")
        for f in remaining[:10]:
            print(f"  - {f}")
        if len(remaining) > 10:
            print(f"  ... and {len(remaining) - 10} more")
    else:
        print("No remaining corruptions found!")

if __name__ == '__main__':
    main()
