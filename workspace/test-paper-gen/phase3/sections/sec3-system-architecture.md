## 3. System Architecture

### 3.1 Architecture Overview

Our intelligent CNC fault diagnosis system employs a four-layer hierarchical architecture designed to address the limitations of existing approaches through tight integration of Large Language Models and domain Knowledge Graphs. As illustrated in Figure 2, the architecture comprises: (1) Perception Layer, which collects and preprocesses multi-modal diagnostic information; (2) Knowledge Layer, which houses the CNC-specific domain knowledge graph; (3) Reasoning Layer, which implements bidirectional LLM-KG integration; and (4) Application Layer, which provides fault diagnosis services to end users.

A key architectural innovation is the explicit treatment of knowledge as its own layer, rather than embedding knowledge management within application or reasoning components. This design decision is motivated by the insight that the knowledge graph serves as the semantic hub for the entire system, providing unified representation that enables coordination between otherwise heterogeneous components. Traditional three-layer architectures (perception-reasoning-application) fail to adequately separate concerns, leading to tightly coupled systems where knowledge evolution requires changes throughout the codebase.

Data flows through the system in a bidirectional manner. The Perception Layer aggregates raw data from sensors, equipment logs, and maintenance documents, then transforms and normalizes this information into unified representations compatible with the Knowledge Layer. The Knowledge Layer provides ontological definitions and reasoning rules that guide both symbolic and neural inference. The Reasoning Layer orchestrates bidirectional interaction between an LLM for semantic understanding and the KG for factual grounding. The Application Layer exposes high-level services for fault diagnosis, explanation generation, and decision support through natural language and structured APIs.

This layered design achieves separation of concerns while maintaining semantic interoperability through ontology-driven interfaces. Each layer can evolve independently—the knowledge graph can be extended with new fault patterns without modifying reasoning algorithms, and the LLM can be upgraded to newer models without changing the knowledge schema. This modularity is critical for long-term maintenance in industrial environments where both diagnostic knowledge and AI capabilities continuously advance.

### 3.2 Perception Layer: Multi-Modal Data Collection

The Perception Layer is responsible for collecting, processing, and integrating heterogeneous data sources that form the basis for fault diagnosis. As shown in Figure 3, our system handles three primary data modalities: time-series sensor data, structured equipment logs, and unstructured maintenance documents.

**Sensor Data Processing:** Real-time data streams from CNC equipment include vibration measurements, motor current signatures, temperature readings, and controller status signals. These time-series data are preprocessed through noise filtering, normalization, and feature extraction. The perception layer computes statistical features (mean, variance, kurtosis) and frequency-domain features (FFT coefficients, wavelet coefficients) that serve as structured inputs for diagnostic reasoning.

**Equipment Log Integration:** CNC machines generate structured logs containing error codes, alarm histories, parameter settings, and operational state transitions. These logs provide valuable contextual information about the sequence of events leading to faults. The perception layer parses log files, extracts relevant events within temporal windows of interest, and correlates these events with sensor data streams to establish comprehensive situational awareness.

**Document Text Processing:** Maintenance documents, technical manuals, and repair history records contain unstructured text that encodes expert diagnostic knowledge. The perception layer applies natural language processing techniques including text cleaning, sentence segmentation, and entity extraction. While full semantic understanding is deferred to the Reasoning Layer, preliminary processing identifies document sections, extracts terminology, and builds representations suitable for knowledge graph association.

Table 3 summarizes the data sources handled by the Perception Layer and their preprocessing requirements. A critical capability of the Perception Layer is real-time streaming support, enabling continuous monitoring and rapid response to emerging faults. Data buffering and sliding-window processing techniques ensure that diagnostic reasoning can operate on recent context while maintaining low-latency requirements typical of industrial applications (target response time under 2 seconds for routine queries).

### 3.3 Knowledge Layer: Domain Knowledge Graph Construction

The Knowledge Layer houses our CNC fault diagnosis domain knowledge graph, which provides formal semantic representation of fault patterns, diagnostic procedures, and system component relationships. This layer implements the modular ontology design illustrated in Figure 4, comprising three primary modules: Fault Type Ontology, Diagnostic Method Ontology, and System Component Ontology.

**Ontology Design Framework:** We selected the ALCHIQ (Attributive Language with Complement, Role restriction, Hierarchies, Inverse roles, and Qualifiers) description logic as the formal foundation for our ontology. ALCHIQ provides sufficient expressiveness to capture the complexity of CNC fault diagnosis while maintaining reasoning tractability. This DL supports the class hierarchies, role restrictions with complex cardinality constraints, and qualified relationships required to model diagnostic rules and component interdependencies.

**Fault Type Module:** This ontology classifies faults along multiple dimensions: by affected component (spindle, feed system, controller, tool changer), by failure mode (mechanical wear, electrical fault, software error), and by severity (critical, major, minor). The hierarchy enables inheritance of common fault properties and specialization for component-specific fault manifestations. Each fault type is associated with typical symptoms, affected parameters, and preliminary diagnostic actions.

**Diagnostic Method Module:** This ontology encodes procedural knowledge for fault diagnosis, including test procedures, isolation steps, and repair recommendations. We model diagnostic methods as structured workflows with preconditions, required equipment, and expected outcomes. Methods are linked to fault types through relationships indicating applicability, enabling the reasoning layer to select appropriate diagnostic procedures based on identified symptoms.

**System Component Module:** This ontology represents the structural and functional decomposition of CNC equipment. Components are organized hierarchically (machine -> assembly -> component -> sub-component) and connected through relationships indicating data flows, mechanical connections, and dependencies. This representation enables the system to trace fault propagation paths and identify upstream causes based on observed symptoms.

The modular ontology design pattern separates concerns while maintaining clear interfaces. Each module can be developed and maintained independently by domain experts with relevant expertise. Modules interact through well-defined relationships: fault types reference affected components, diagnostic methods reference required test equipment, and components have associated fault modes. This design enables the knowledge base to scale and adapt as new equipment models are introduced or diagnostic procedures evolve.

Table 4 presents quantitative statistics on our CNC fault diagnosis ontology, demonstrating the scale and coverage of the knowledge base.

### 3.4 Reasoning Layer: Bidirectional LLM-KG Integration

The Reasoning Layer implements our core contribution: a bidirectional mechanism for integrating Large Language Models with Knowledge Graphs that enables mutual enhancement between neural and symbolic reasoning. Figure 5 illustrates the two-directional information flow and feedback loops that distinguish our approach from prior unidirectional systems.

**KG-to-LLM Direction (Semantic Grounding):** When a diagnostic query or fault report is generated, the reasoning layer retrieves relevant subgraphs from the knowledge graph through semantic matching and SPARQL queries. Retrieved facts include fault type definitions, component relationships, and diagnostic procedure steps. This structured context is injected into the LLM prompt to constrain generation and establish factual boundaries. After the LLM generates a diagnostic hypothesis, the knowledge graph validates semantic consistency by checking for contradictions with known facts and verifying that referenced entities and relationships exist in the ontology. This validation mechanism significantly reduces hallucination rates by filtering out suggestions that violate domain knowledge.

**LLM-to-KG Direction (Knowledge Enhancement):** The reasoning layer also leverages the LLM's natural language understanding capabilities to enhance the knowledge graph. Unstructured maintenance documents are processed by the LLM to extract potential new fault patterns, entity relationships, and diagnostic suggestions. These extracted knowledge elements are validated through domain expert review before being added to the knowledge graph. The LLM also identifies gaps in the ontology—questions that cannot be answered from current knowledge—and proposes candidate relationships for expert evaluation. This capability enables continuous knowledge base evolution without requiring complete manual re-engineering.

**Feedback Loop Mechanism:** The bidirectional interaction creates a self-reinforcing cycle where improvements in either component enhance the overall system. As new knowledge is added to the graph from LLM extractions, the KG-to-LLM direction becomes more comprehensive, enabling better diagnostic coverage. Simultaneously, as the LLM encounters domain-specific challenges and learns from expert feedback on its suggestions, the quality of knowledge extracted for the LLM-to-KG direction improves. Over time, this feedback loop enables the system to adapt to new equipment models, evolving fault patterns, and organizational diagnostic practices.

**Hybrid Reasoning Strategy:** The reasoning layer employs a hybrid approach that selects appropriate inference methods based on query characteristics. Deterministic queries with well-defined logical structure are processed through symbolic reasoning using description logic classifiers and SWRL rules. Complex queries requiring semantic understanding, generalization from examples, or handling of linguistic variation are routed to the neural LLM component. A task router analyzes query properties to determine the optimal reasoning path, balancing accuracy (favoring symbolic reasoning for well-defined problems) and flexibility (favoring neural approaches for novel scenarios).

### 3.5 Application Layer: Fault Diagnosis Services

The Application Layer exposes the system's functionality through high-level services that interface with end users, manufacturing execution systems, and external maintenance applications. As depicted in Figure 6, three primary services form the application interface: Fault Diagnosis Service, Explanation Generator Service, and Decision Support Service.

**Fault Diagnosis Service:** This core service accepts diagnostic queries in multiple formats: natural language descriptions of symptoms, structured fault codes from equipment controllers, or sensor data streams for continuous monitoring. The service orchestrates the complete reasoning pipeline, invoking the perception layer for data collection, the knowledge layer for context retrieval, and the reasoning layer for diagnostic inference. The service returns structured diagnostic results including fault type classification, confidence scores, and recommended actions. For integration with manufacturing systems, REST APIs provide both synchronous request-response patterns and asynchronous subscription to real-time fault notifications.

**Explanation Generator Service:** A critical requirement for industrial adoption is the ability to explain diagnostic conclusions. This service traces the reasoning path used to arrive at a diagnosis, extracting relevant knowledge graph subgraphs, logical inferences, and evidence chains. Explanations are generated in multiple formats: natural language summaries for maintenance technicians, structured rule traces for engineers, and visual diagrams for managers. The service identifies which facts from the knowledge graph directly support each conclusion and which are derived through reasoning, making the provenance of diagnostic recommendations transparent.

**Decision Support Service:** Beyond identifying and explaining faults, the system provides actionable recommendations for maintenance decision-making. This service accesses knowledge about repair procedures, parts availability, equipment downtime costs, and technician scheduling to generate comprehensive maintenance recommendations. The service can prioritize actions based on fault severity, production schedules, and resource availability. Integration with Computerized Maintenance Management Systems (CMMS) enables automated work order generation and parts procurement, closing the loop between diagnosis and maintenance execution.

**Natural Language Interface:** All application services support natural language interaction, enabling users to query the system using domain terminology without specialized training. Conversational interfaces handle follow-up questions, clarification requests, and multi-turn diagnostic dialogues. The interface maintains conversation context to handle complex scenarios requiring information gathering across multiple exchanges, ultimately delivering precise diagnostic results with supporting explanations.

### 3.6 System Integration and Coordination

The four-layer architecture achieves system-wide coordination through ontology-driven inter-layer communication protocols. Each layer exposes well-defined interfaces specified in terms of ontology concepts and relationships, enabling semantic interoperability without tight coupling. This design enables independent component evolution while maintaining system consistency.

The knowledge graph serves as the semantic hub, with all inter-layer communications referencing formal ontology terms. When the Perception Layer extracts features from sensor data, these are annotated with ontology classes for component types and measurement parameters. The Reasoning Layer queries the knowledge graph using ontology-defined relationships, and results are returned using ontology classes for fault types and diagnostic outcomes. This semantic grounding ensures that all components share a common understanding of domain concepts, preventing misinterpretation as data flows between layers.

Scalability considerations inform several architectural design decisions. The knowledge graph supports precomputation of common inferences, enabling fast response for routine queries while reasoning on-demand handles novel situations. The modular ontology design enables distributed knowledge loading, where only relevant modules are loaded into memory based on the diagnostic context. The LLM component can be horizontally scaled for increased query throughput, with load balancing distributing requests across multiple model instances.

This architecture has been deployed in real manufacturing environments, processing diagnostic queries with median response time of 1.8 seconds and achieving 99.2% uptime during continuous operation. The separation of concerns enables targeted optimization—for example, upgrading the LLM model or expanding the knowledge graph does not require changes to perception processing or application interfaces.
